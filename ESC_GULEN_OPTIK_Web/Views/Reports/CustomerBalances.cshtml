@model List<dynamic>
@{
    ViewData["Title"] = "Customer Outstanding Balances";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-exclamation-triangle me-2"></i>Customer Outstanding Balances</h2>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Back to Reports
    </a>
</div>

<div class="card">
    <div class="card-body">
        @if (Model.Count == 0)
        {
            <div class="alert alert-success">
                <i class="bi bi-check-circle me-2"></i>All customers have paid their balances!
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th class="text-center">Transactions</th>
                            <th>Last Transaction</th>
                            <th class="text-end">Outstanding Balance</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td><strong>@item.CustomerName</strong></td>
                                <td class="text-center">@item.TransactionCount</td>
                                <td>
                                    @if (item.LastTransactionDate != null)
                                    {
                                        @item.LastTransactionDate.ToString("dd/MM/yyyy")
                                    }
                                </td>
                                <td class="text-end">
                                    <span class="text-danger fw-bold fs-5">@item.TotalOutstanding.ToString("N2") ₺</span>
                                </td>
                                <td>
                                    <a asp-controller="Customer" asp-action="Details" asp-route-id="@item.CustomerID" 
                                       class="btn btn-sm btn-outline-primary">
                                        View Customer
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                    <tfoot class="table-warning">
                        <tr>
                            <td colspan="3"><strong>Total Outstanding:</strong></td>
                            <td class="text-end"><strong class="fs-4">@Model.Sum(x => (decimal)x.TotalOutstanding).ToString("N2") ₺</strong></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }
    </div>
</div>

